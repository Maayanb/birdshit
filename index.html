<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cute Bird Poop Game</title>
    <!-- Inline fart sound directly in the HTML to guarantee availability -->
    <audio id="fartSound" preload="auto">
        <source src="fart.m4a" type="audio/mp4">
        Your browser does not support the audio element.
    </audio>
    <!-- Rest of your head section remains unchanged -->
</head>
<body ontouchstart="">
    <!-- Rest of your body section remains unchanged -->

    <script>
        // Prevent double-tap zoom, etc. (unchanged)
        // ... (previous script code remains unchanged)

        // Improved Sound System
        const fartSound = document.getElementById('fartSound');
        const MAX_SOUNDS = 3; // Limit to 3 sounds in pool
        const soundPool = [];
        let isSoundEnabled = false; // Track if sound is unlocked

        // Initialize sound pool
        function initializeSoundPool() {
            for (let i = 0; i < MAX_SOUNDS; i++) {
                const sound = new Audio('fart.m4a'); // Updated to .m4a
                sound.preload = 'auto'; // Ensure preloading
                sound.volume = 0.8;
                soundPool.push(sound);
            }
        }

        // Unlock audio for mobile devices (iOS fix) - unchanged
        function unlockAudio() {
            if (isSoundEnabled) return; // Already unlocked

            const unlockPromises = [];
            if (fartSound) {
                unlockPromises.push(
                    fartSound.play().then(() => {
                        fartSound.pause();
                        fartSound.currentTime = 0;
                    }).catch(e => console.log('Main audio unlock failed:', e))
                );
            }

            soundPool.forEach(sound => {
                unlockPromises.push(
                    sound.play().then(() => {
                        sound.pause();
                        sound.currentTime = 0;
                    }).catch(e => console.log('Backup audio unlock failed:', e))
                );
            });

            Promise.all(unlockPromises).then(() => {
                isSoundEnabled = true;
                console.log('Audio unlocked successfully');
            });
        }

        // Play fart sound using sound pool - unchanged
        function playFartSound() {
            if (!isSoundEnabled) {
                console.log('Sound not yet enabled. Please interact with the game first.');
                return;
            }

            const sound = soundPool.shift(); // Take first sound from pool
            sound.currentTime = 0;
            sound.play().catch(e => {
                console.error('Sound playback failed:', e);
            });
            soundPool.push(sound); // Put it back at the end of the pool
        }

        // Rest of your script remains unchanged
        // ... (rest of the script code)
    </script>
</body>
</html>
